services:
  - type: web
    name: worktime-app
    env: node
    buildCommand: |
      echo "🚀 開始 Render.com 建置流程..."
      echo "📁 當前目錄: $(pwd)"
      echo "📋 目錄內容:"
      ls -la
      
      # 檢查環境
      echo "🔍 檢查環境..."
      node --version
      npm --version
      
      # 檢查必要檔案
      echo "🔍 檢查必要檔案..."
      required_files=(
          "client/package.json"
          "client/src/index.tsx"
          "client/public/index.html"
          "server/package.json"
          "server/index.js"
      )
      
      for file in "${required_files[@]}"; do
          if [ -f "$file" ]; then
              echo "  ✅ $file"
          else
              echo "  ❌ $file (缺失)"
              exit 1
          fi
      done
      
      # 安裝依賴
      echo "📦 安裝根目錄依賴..."
      npm install --no-audit --no-fund --legacy-peer-deps
      
      echo "📦 安裝前端依賴..."
      cd client
      npm install --no-audit --no-fund --legacy-peer-deps
      cd ..
      
      echo "📦 安裝後端依賴..."
      cd server
      npm install --no-audit --no-fund --legacy-peer-deps
      cd ..
      
      echo "✅ 依賴安裝完成"
      echo "📋 伺服器將在啟動時自動建置前端"
      
      echo "🎉 Render.com 建置流程完成！"
    startCommand: NODE_ENV=production node server/index.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
    healthCheckPath: /health
    autoDeploy: true 