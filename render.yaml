services:
  - type: web
    name: worktime-app
    env: node
    buildCommand: |
      echo "ğŸš€ é–‹å§‹ Render.com å»ºç½®æµç¨‹..."
      echo "ğŸ“ ç•¶å‰ç›®éŒ„: $(pwd)"
      echo "ğŸ“‹ ç›®éŒ„å…§å®¹:"
      ls -la
      
      # æª¢æŸ¥ç’°å¢ƒ
      echo "ğŸ” æª¢æŸ¥ç’°å¢ƒ..."
      node --version
      npm --version
      
      # æª¢æŸ¥å¿…è¦æª”æ¡ˆ
      echo "ğŸ” æª¢æŸ¥å¿…è¦æª”æ¡ˆ..."
      required_files=(
          "client/package.json"
          "client/src/index.tsx"
          "client/public/index.html"
          "server/package.json"
          "server/index.js"
      )
      
      for file in "${required_files[@]}"; do
          if [ -f "$file" ]; then
              echo "  âœ… $file"
          else
              echo "  âŒ $file (ç¼ºå¤±)"
              exit 1
          fi
      done
      
      # å®‰è£ä¾è³´
      echo "ğŸ“¦ å®‰è£æ ¹ç›®éŒ„ä¾è³´..."
      npm install --no-audit --no-fund --legacy-peer-deps
      
      echo "ğŸ“¦ å®‰è£å‰ç«¯ä¾è³´..."
      cd client
      npm install --no-audit --no-fund --legacy-peer-deps
      cd ..
      
      echo "ğŸ“¦ å®‰è£å¾Œç«¯ä¾è³´..."
      cd server
      npm install --no-audit --no-fund --legacy-peer-deps
      cd ..
      
      echo "âœ… ä¾è³´å®‰è£å®Œæˆ"
      echo "ğŸ“‹ ä¼ºæœå™¨å°‡åœ¨å•Ÿå‹•æ™‚è‡ªå‹•å»ºç½®å‰ç«¯"
      
      echo "ğŸ‰ Render.com å»ºç½®æµç¨‹å®Œæˆï¼"
    startCommand: NODE_ENV=production node server/index.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
    healthCheckPath: /health
    autoDeploy: true 